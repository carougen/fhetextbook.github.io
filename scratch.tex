\subsection{Another Version of RNS-based BFV Decryption: $\textsf{Dec}_{\textsf{RNS}}^{\textsf{BFV2}}$}
\label{subsubsec:rns-dec-bfv2}

Let's verify if we can do BFV decryption by doing \textsf{ModRaise\textsubscript{RNS}} $\rightarrow$ \textsf{ModSwitch\textsubscript{RNS}} $\rightarrow$ \textsf{FastBConv} $\rightarrow$ \textsf{FastBConvEx}. 

$ $

The input to $\textsf{Dec}_{\textsf{RNS}}^{\textsf{BFV2}}$ is $\textsf{ct}(s) = \Delta m + e + kq$, and we need the output to be $[m]_t$. The RNS vector representation of the input is $(x_1, x_2, \cdots, x_k) \in \mathbb{Z}_{q_1} \times \mathbb{Z}_{q_2} \times \cdots \times \mathbb{Z}_{q_k}$, where each $x_i = (\Delta m + e + kq)_i \in \mathbb{Z}_{q_i}$, and $\Delta = \left\lfloor\dfrac{q}{t}\right\rfloor$. The proposed  decryption function's procedure is as follows:

$ $

\begin{enumerate}

\item \textbf{\underline{\textsf{ModRaise}} from $q \rightarrow qb$:}

$\textsf{ModRaise\textsubscript{RNS}}(x, q, qb)$ \textcolor{red}{ \# where $b > q$}

$= (x_1, x_2, \cdots, x_{q_k}, \textsf{FastBConv}(x, q, b))$

$= (x_1, x_2, \cdots, x_{q_k}, c_1, c_2, \cdots, c_l)$
 \textcolor{red}{ \# where $c = x + uq \bmod b$ ($|u| \leq \dfrac{k}{2}$ without \textsf{SmallMont}, and $|u| \leq 1$ with \textsf{SmallMont})}
 
$ 
%= (\chi_1, \chi_2, \cdots, \chi_{k+l}) 
\text{ } \in \mathbb{Z}_{q_1} \times \mathbb{Z}_{q_2} \times \cdots \times \mathbb{Z}_{q_k} \times \mathbb{Z}_{b_1} \times \mathbb{Z}_{b_2} \times \cdots \times \mathbb{Z}_{b_l}$   

$ $ 

The above RNS representation collectively represents the value $x + uq \bmod qb$. We assume that we chose a sufficiently large $b$ such that $x + uq \ll qb$. Therefore, $[x + uq]_{qb} = x + uq$.

$ $

\item \textbf{\underline{Multiplication} by $t$:} 

$t\cdot 
%(\chi_1, \chi_2, \cdots, \chi_{k+l}) = (t\chi_1, t\chi_2, \cdots, t\chi_{k+l})
(x_1, x_2, \cdots, x_{q_k}, c_1, c_2, \cdots, c_l)
\in \mathbb{Z}_{q_1} \times \mathbb{Z}_{q_2} \times \cdots \times \mathbb{Z}_{q_k} \times \mathbb{Z}_{b_1} \times \mathbb{Z}_{b_2} \times \cdots \times \mathbb{Z}_{b_l}$

$ = 
%(\nu_1, \nu_2, \cdots, \nu_{k+1}) 
([t\cdot x_1]_{q_1}, [t\cdot x_2]_{q_2}, \cdots, [t\cdot x_{q_k}]_{q_k}, [t\cdot c_1]_{b_1}, [t\cdot c_2]_{b_2}, \cdots, [t\cdot c_l]_{b_l})$ 


$ = (\nu_1, \nu_2, \cdots, \nu_{k+l}) \in \mathbb{Z}_{q_1} \times \mathbb{Z}_{q_2} \times \cdots \times \mathbb{Z}_{q_k} \times \mathbb{Z}_{b_1} \times \mathbb{Z}_{b_2} \times \cdots \times \mathbb{Z}_{b_l}$

$ $

, where $\nu = t\cdot (x + u\cdot q) \bmod qb = [tx + tuq]_{qb}$. Again, we assume that $b$ is sufficiently large such that $t\cdot(x + uq) \ll qb$. Therefore, $[tx + tuq]_{qb} = tx + tuq$.

$ $

\item \textbf{\underline{\textsf{ModSwitch}} from $qb \rightarrow b$:}

$ $

$\textsf{FastBConv}\bm(\\nu_1\}_{i=1}^{k}, q, b\bm)$

$ = (\hat\nu_1, \hat\nu_2, \cdots, \hat\nu_l) \in \mathbb{Z}_{b_1} \times \mathbb{Z}_{b_2} \times \cdots \times \mathbb{Z}_{b_l}$ 

$ $

, where $\hat\nu = \Big[[tx + tuq]_{q} + u'q\Big]_b = \Big[[tx]_{q} + u'q\Big]_b$ \textcolor{red}{\# $|u'| \leq [\dfrac{l}{2}]$ is the new noise generated by \textsf{FastBConv}}

$ $

$ $

$\textsf{ModSwitch\textsubscript{RNS}}(\{\nu_i\}_{i=1}^k \cup \{\nu_j\}_{j=1}^l, qb, b)$

$ = \{|q^{-1}|_{q_j} \cdot (\nu_j - \hat{\nu}_j) \bmod b_j\}_{i=1}^{l} \in \mathbb{Z}_{b_1} \times \mathbb{Z}_{b_2} \times \cdots \times \mathbb{Z}_{b_l}$ 

$ = (\tau_1, \tau_2, \cdots, \tau_l) \in \mathbb{Z}_{b_1} \times \mathbb{Z}_{b_2} \times \cdots \times \mathbb{Z}_{b_l}$

$ $

, where $\tau = [q^{-1}\cdot(\nu - \hat{\nu})]_b$

$= \Big[q^{-1}\cdot(tx + tuq - [tx]_{q} - u'q)\Big]_b$

$ = \left[\dfrac{tx - [tx]_{q}}{q} + tu + u')\right]_b$ \textcolor{red}{ \# since $\dfrac{tx - [tx]_{q}}{q}$ is an integer, and $[q^{-1}]_b$ exists (as $q$ and $b$ are co-prime)}

$ = \left[\left\lfloor\dfrac{tx}{q}\right\rfloor + tu + u')\right]_b$

$ = \left\lfloor\dfrac{tx}{q}\right\rfloor + tu + u'$ \textcolor{red}{ \# since $\left|\left\lfloor\dfrac{tx}{q}\right\rfloor + tu + u'\right| \leq b$}


$ $

$ $

\item \textbf{\underline{\textsf{FastBConvEx}} from $b \rightarrow t$:} 

$\hat{\tau} = \textsf{ModDrop}(\tau, b, \hat{b})$ 

$\beta_{\hat{\tau}} = (\textsf{FastBConv}(\hat{\tau}, \hat{b}, b_\alpha) - \hat{\tau})\cdot \hat{b}^{-1}$ \textcolor{red}{ \# where $b_\alpha = \dfrac{b}{\hat b}$ is a one modulus factor}

$ $

$\textsf{FastBConvEx}(\tau, b, t) = \Big|\textsf{FastBConv}(\hat{\tau}, \hat{b}, t) - |\beta_{\hat{\tau}}|_{b_{\alpha}} \cdot\hat{b}\Big|_t $

$= |\tau|_t$

$ $

$ = \left|\left\lfloor\dfrac{tx}{q}\right\rfloor + tu + u')\right|_t$

$ $

$ = \left\lfloor\dfrac{tx}{q}\right\rfloor + u'$

$ = m + \epsilon + u'$ \textcolor{red}{ \# where $\epsilon$ is a ronding error}

$ \neq m$

\textcolor{red}{ALERT: The decryption is not exactly $m$ due to the noises $\epsilon$ and $u'$}

\end{enumerate}

\clearpage